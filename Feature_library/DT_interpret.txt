from sklearn.tree import _tree

def extract_rules(tree, feature_names):
    rules = []

    def recurse(node, conditions):
        if tree.feature[node] != _tree.TREE_UNDEFINED:
            name = feature_names[tree.feature[node]]
            threshold = tree.threshold[node]

            recurse(
                tree.children_left[node],
                conditions + [f"{name} <= {threshold:.3f}"]
            )
            recurse(
                tree.children_right[node],
                conditions + [f"{name} > {threshold:.3f}"]
            )
        else:
            rules.append({
                'rule': ' AND '.join(conditions),
                'samples': tree.n_node_samples[node],
                'fraud_rate': tree.value[node][0][1] / tree.n_node_samples[node]
            })

    recurse(0, [])
    return pd.DataFrame(rules)

rules_df = extract_rules(dt.tree_, X.columns)
rules_df.sort_values('fraud_rate', ascending=False).head(10)
