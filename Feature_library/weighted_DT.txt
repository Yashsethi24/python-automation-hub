import numpy as np

# Base weights
train_df['sample_weight'] = 1.0

# Increase weight for fraud by loss
train_df.loc[train_df['target'] == 1, 'sample_weight'] = (
    train_df.loc[train_df['target'] == 1, 'CUR_BAL_SUM_TOT']
)

# Optional: cap extreme outliers
cap = train_df.loc[train_df['target'] == 1, 'sample_weight'].quantile(0.99)
train_df['sample_weight'] = np.minimum(train_df['sample_weight'], cap)

# Optional: normalize
train_df['sample_weight'] /= train_df['sample_weight'].mean()



from sklearn.tree import DecisionTreeClassifier

dt = DecisionTreeClassifier(
    max_depth=4,
    min_samples_leaf=100,
    min_samples_split=300,
    class_weight='balanced',
    random_state=42
)

dt.fit(
    X_train,
    y_train,
    sample_weight=train_df.loc[X_train.index, 'sample_weight']
)
